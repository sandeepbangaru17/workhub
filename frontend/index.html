<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WorkHub ‚Ä¢ Premium</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#050815;
      --bg1:#070b1c;

      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.085);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.16);

      --text:#eef2ff;
      --muted: rgba(238,242,255,.72);
      --muted2: rgba(238,242,255,.50);

      --brand:#38bdf8;
      --brand2:#a78bfa;
      --ok:#34d399;
      --bad:#fb7185;
      --warn:#fbbf24;

      --shadow: 0 22px 70px rgba(0,0,0,.45);
      --shadow2: 0 14px 30px rgba(0,0,0,.30);

      --r1: 22px;
      --r2: 16px;
      --r3: 14px;
    }

    html[data-theme="light"]{
      --bg0:#f4f7ff;
      --bg1:#eef2ff;

      --glass: rgba(0,0,0,.04);
      --glass2: rgba(0,0,0,.06);
      --stroke: rgba(2,6,23,.10);
      --stroke2: rgba(2,6,23,.18);

      --text:#071028;
      --muted: rgba(7,16,40,.72);
      --muted2: rgba(7,16,40,.52);

      --shadow: 0 20px 60px rgba(2,6,23,.14);
      --shadow2: 0 14px 30px rgba(2,6,23,.10);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(56,189,248,.18), transparent 55%),
        radial-gradient(900px 650px at 92% 18%, rgba(167,139,250,.18), transparent 50%),
        radial-gradient(900px 650px at 35% 95%, rgba(52,211,153,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    body:before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity:.22;
    }
    html[data-theme="light"] body:before{ opacity:.12; mix-blend-mode: multiply; }

    .app{
      max-width: 1280px;
      margin: 0 auto;
      padding: 18px 16px 70px;
      display:grid;
      grid-template-columns: 270px 1fr;
      gap: 16px;
      position:relative;
    }
    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
    }

    /* ===== Mobile overlay for sidebar drawer ===== */
    .sbOverlay{
      position: fixed; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      z-index: 45;
      display:none;
    }
    .sbOverlay.show{ display:block; }

    /* ===== Sidebar ===== */
    .sidebar{
      position:sticky;
      top:16px;
      height: calc(100vh - 32px);
      border-radius: var(--r1);
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow2);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      z-index: 50;
    }
    html[data-theme="light"] .sidebar{
      background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.55));
    }

    /* Drawer behavior on mobile */
    @media (max-width: 980px){
      .sidebar{
        position: fixed;
        left: 16px;
        top: 16px;
        height: calc(100vh - 32px);
        width: 300px;
        transform: translateX(calc(-100% - 24px));
        transition: transform .18s ease;
      }
      .sidebar.open{ transform: translateX(0); }
    }

    .sb-top{
      padding: 16px;
      border-bottom: 1px solid var(--stroke);
      display:flex;
      gap:12px;
      align-items:center;
      background: rgba(255,255,255,.03);
    }

    .logo{
      width:44px; height:44px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(56,189,248,.95), rgba(167,139,250,.92));
      display:grid; place-items:center;
      font-weight: 900;
      color:#041022;
      box-shadow: 0 14px 34px rgba(56,189,248,.18);
      user-select:none;
      flex:0 0 auto;
    }

    .sb-title{ flex:1; min-width: 0; }
    .sb-title .t{ margin:0; font-weight:900; font-size:14px; }
    .sb-title .s{ margin:4px 0 0; font-size:12px; color:var(--muted); line-height:1.3; }

    /* Theme toggle */
    .themeToggle{
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      border-radius: 999px;
      padding: 8px 10px;
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      user-select:none;
      transition: .14s ease;
      font-weight: 900;
      font-size: 12px;
      color: var(--muted);
      flex:0 0 auto;
    }
    .themeToggle:hover{ background: rgba(255,255,255,.07); border-color: var(--stroke2); transform: translateY(-1px); }
    html[data-theme="light"] .themeToggle{ background: rgba(255,255,255,.65); }
    .toggleDot{
      width:34px; height:18px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.07);
      position:relative;
      flex:0 0 auto;
    }
    .toggleDot:after{
      content:"";
      position:absolute;
      top:2px; left:2px;
      width:14px; height:14px;
      border-radius: 99px;
      background: linear-gradient(135deg, rgba(56,189,248,.95), rgba(167,139,250,.92));
      transition: .16s ease;
    }
    html[data-theme="light"] .toggleDot:after{ transform: translateX(16px); }

    .sb-nav{ padding: 12px; display:flex; flex-direction:column; gap:8px; }
    .navbtn{
      border:1px solid transparent;
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding: 11px 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      transition: .14s ease;
    }
    html[data-theme="light"] .navbtn{ background: rgba(255,255,255,.55); }
    .navbtn:hover{ border-color: var(--stroke2); background: rgba(255,255,255,.06); transform: translateY(-1px); }
    .navbtn.active{
      border-color: rgba(56,189,248,.40);
      background: linear-gradient(135deg, rgba(56,189,248,.16), rgba(167,139,250,.12));
    }
    .navleft{ display:flex; align-items:center; gap:10px; font-weight: 900; font-size: 13px; }
    .navicon{
      width:30px; height:30px;
      border-radius: 12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      font-size: 14px;
    }
    .navmeta{
      font-size: 11px;
      color: var(--muted2);
      font-weight: 800;
      padding: 6px 8px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      border-radius: 999px;
      white-space: nowrap;
    }
    html[data-theme="light"] .navmeta{ background: rgba(255,255,255,.6); }

    .sb-bottom{
      margin-top:auto;
      padding: 14px 14px 16px;
      border-top: 1px solid var(--stroke);
      display:flex;
      flex-direction:column;
      gap:10px;
      background: rgba(0,0,0,.10);
    }
    html[data-theme="light"] .sb-bottom{ background: rgba(255,255,255,.35); }

    .pill{
      display:flex; align-items:center; gap:8px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      padding: 10px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 800;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    html[data-theme="light"] .pill{ background: rgba(255,255,255,.6); }

    .dot{
      width:8px; height:8px; border-radius:99px; display:inline-block;
      background: rgba(255,255,255,.25);
      box-shadow: 0 0 0 3px rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .dot.ok{ background: rgba(52,211,153,.92); box-shadow: 0 0 0 3px rgba(52,211,153,.14); }
    .dot.bad{ background: rgba(251,113,133,.92); box-shadow: 0 0 0 3px rgba(251,113,133,.14); }

    /* ===== Main ===== */
    .main{
      border-radius: var(--r1);
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    html[data-theme="light"] .main{
      background: linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.55));
    }

    .topbar{
      padding: 14px 16px;
      border-bottom: 1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: rgba(255,255,255,.03);
    }
    .topbar h1{ margin:0; font-size: 14px; font-weight: 900; }
    .topbar p{ margin:5px 0 0; font-size: 12px; color: var(--muted); }

    .topLeft{ display:flex; align-items:center; gap:10px; }
    .hamburger{
      display:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: .14s ease;
      font-weight: 900;
      font-size: 12px;
    }
    .hamburger:hover{ transform: translateY(-1px); border-color: var(--stroke2); background: rgba(255,255,255,.09); }
    @media (max-width: 980px){
      .hamburger{ display:inline-flex; align-items:center; gap:8px; }
    }

    .topActions{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

    .btn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      font-weight: 900;
      letter-spacing: .1px;
      font-size: 12px;
    }
    html[data-theme="light"] .btn{ background: rgba(255,255,255,.68); }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.09); border-color: var(--stroke2); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

    .btn.primary{
      border-color: rgba(56,189,248,.35);
      background: linear-gradient(135deg, rgba(56,189,248,.18), rgba(167,139,250,.14));
    }
    .btn.ghost{ background: rgba(0,0,0,.18); }
    html[data-theme="light"] .btn.ghost{ background: rgba(255,255,255,.45); }
    .btn.danger{
      border-color: rgba(251,113,133,.38);
      background: rgba(251,113,133,.12);
    }

    .content{ padding: 16px; }

    /* ===== KPI Dashboard Cards ===== */
    .kpis{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }
    @media (max-width: 980px){
      .kpis{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 520px){
      .kpis{ grid-template-columns: 1fr; }
    }
    .kpiCard{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius: var(--r2);
      padding: 12px;
      box-shadow: var(--shadow2);
      position:relative;
      overflow:hidden;
    }
    html[data-theme="light"] .kpiCard{ background: rgba(255,255,255,.70); }
    .kpiCard:before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(circle at 30% 20%, rgba(56,189,248,.18), transparent 50%),
                  radial-gradient(circle at 80% 70%, rgba(167,139,250,.16), transparent 55%);
      transform: rotate(8deg);
      opacity:.85;
      pointer-events:none;
    }
    .kpiLabel{ position:relative; font-size:12px; color: var(--muted); font-weight: 900; }
    .kpiValue{ position:relative; margin-top: 6px; font-size: 20px; font-weight: 1000; letter-spacing: -0.4px; }
    .kpiHint{ position:relative; margin-top: 6px; font-size: 12px; color: var(--muted2); font-weight: 800; }

    .controls{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      margin-bottom: 12px;
    }
    .leftControls{ display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end; }
    .rightControls{ display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end; justify-content:flex-end; }

    .field{
      display:flex;
      flex-direction:column;
      gap:7px;
      min-width: 190px;
    }
    .field label{
      font-size: 12px;
      color: var(--muted);
      font-weight: 800;
    }
    input, select, textarea{
      width:100%;
      background: rgba(0,0,0,.20);
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 11px 12px;
      color: var(--text);
      outline:none;
      font-size: 13px;
      transition: border-color .14s ease, background .14s ease;
    }
    html[data-theme="light"] input,
    html[data-theme="light"] select,
    html[data-theme="light"] textarea{
      background: rgba(255,255,255,.72);
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(56,189,248,.40);
      background: rgba(0,0,0,.26);
    }
    html[data-theme="light"] input:focus,
    html[data-theme="light"] select:focus,
    html[data-theme="light"] textarea:focus{
      background: rgba(255,255,255,.88);
    }
    ::placeholder{ color: rgba(238,242,255,.35); }
    html[data-theme="light"] ::placeholder{ color: rgba(7,16,40,.35); }
    textarea{ min-height: 90px; resize: vertical; }

    .kpi{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.14);
      border-radius: 999px;
      padding: 9px 10px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 900;
    }
    html[data-theme="light"] .kpi{ background: rgba(255,255,255,.6); }

    .list{ display:flex; flex-direction:column; gap:12px; }
    .item{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius: var(--r2);
      padding: 14px;
      display:flex;
      gap: 12px;
      align-items:flex-start;
      justify-content:space-between;
      transition: transform .14s ease, border-color .14s ease, background .14s ease;
    }
    html[data-theme="light"] .item{ background: rgba(255,255,255,.65); }
    .item:hover{
      transform: translateY(-1px);
      border-color: var(--stroke2);
      background: rgba(255,255,255,.07);
    }

    .titleRow{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .item h3{ margin:0; font-size: 13px; font-weight: 900; }
    .item p{ margin: 6px 0 0; font-size: 12px; color: var(--muted); line-height:1.45; }

    .actions{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: 8px;
      flex-wrap:wrap;
      min-width: 210px;
    }

    .badge{
      display:inline-flex; align-items:center; gap:7px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 900;
      white-space: nowrap;
    }
    html[data-theme="light"] .badge{ background: rgba(255,255,255,.6); }

    .badge.ok{ border-color: rgba(52,211,153,.34); background: rgba(52,211,153,.10); }
    .badge.bad{ border-color: rgba(251,113,133,.40); background: rgba(251,113,133,.10); }
    .badge.warn{ border-color: rgba(251,191,36,.38); background: rgba(251,191,36,.10); }
    .badge.brand{ border-color: rgba(56,189,248,.35); background: rgba(56,189,248,.10); }

    .hint{ color: var(--muted2); font-size: 12px; }

    .skeleton{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius: var(--r2);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    html[data-theme="light"] .skeleton{ background: rgba(255,255,255,.65); }

    .sk-line{ height: 10px; border-radius: 999px; background: rgba(255,255,255,.09); margin: 10px 0; }
    html[data-theme="light"] .sk-line{ background: rgba(2,6,23,.08); }
    .sk-line.w1{ width: 55%; }
    .sk-line.w2{ width: 78%; }
    .sk-line.w3{ width: 45%; }
    .skeleton:before{
      content:"";
      position:absolute; inset:-20px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.10), transparent);
      transform: translateX(-60%);
      animation: shimmer 1.1s infinite;
    }
    html[data-theme="light"] .skeleton:before{
      background: linear-gradient(90deg, transparent, rgba(2,6,23,.08), transparent);
    }
    @keyframes shimmer{
      0%{ transform: translateX(-70%); }
      100%{ transform: translateX(70%); }
    }

    .toasts{
      position: fixed;
      right: 18px;
      top: 18px;
      z-index: 60;
      display:flex;
      flex-direction:column;
      gap:10px;
      width: min(380px, calc(100vw - 36px));
    }
    .toast{
      border:1px solid var(--stroke);
      background: rgba(10,14,34,.75);
      backdrop-filter: blur(14px);
      border-radius: 18px;
      padding: 12px 12px;
      box-shadow: var(--shadow2);
      display:flex;
      gap: 10px;
      align-items:flex-start;
      animation: pop .18s ease;
    }
    html[data-theme="light"] .toast{ background: rgba(255,255,255,.82); }

    @keyframes pop{
      from{ transform: translateY(-6px); opacity: 0; }
      to{ transform: translateY(0); opacity: 1; }
    }
    .ticon{
      width:34px; height:34px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      font-weight: 900;
      flex:0 0 auto;
    }
    .toast.ok{ border-color: rgba(52,211,153,.35); }
    .toast.bad{ border-color: rgba(251,113,133,.40); }
    .toast.warn{ border-color: rgba(251,191,36,.38); }

    .toast h4{ margin:0; font-size: 13px; font-weight: 900; }
    .toast p{ margin:4px 0 0; font-size: 12px; color: var(--muted); line-height: 1.4; }
    .toast .x{
      margin-left:auto;
      border:none;
      background: transparent;
      color: var(--muted);
      cursor:pointer;
      font-size: 14px;
      padding: 4px 8px;
      border-radius: 10px;
    }
    .toast .x:hover{ background: rgba(255,255,255,.08); color: var(--text); }

    .modalWrap{
      position:fixed; inset:0;
      z-index: 70;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
    }
    .modal{
      width: min(740px, 100%);
      border-radius: 22px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    html[data-theme="light"] .modal{
      background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.70));
    }
    .modalHd{
      padding: 14px 16px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: rgba(255,255,255,.03);
    }
    .modalHd h3{ margin:0; font-size: 14px; font-weight: 900; }
    .modalBd{ padding: 16px; }
    .modalFt{
      padding: 14px 16px;
      border-top:1px solid var(--stroke);
      display:flex;
      gap:10px;
      justify-content:flex-end;
      background: rgba(0,0,0,.12);
    }
    html[data-theme="light"] .modalFt{ background: rgba(255,255,255,.45); }

    .closeBtn{
      border:none;
      background: rgba(255,255,255,.08);
      color: var(--text);
      cursor:pointer;
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 900;
    }
    .closeBtn:hover{ background: rgba(255,255,255,.12); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > *{ flex: 1; min-width: 210px; }

    .hide{ display:none !important; }
  </style>
</head>

<body>
  <div class="toasts" id="toasts"></div>

  <!-- mobile overlay -->
  <div class="sbOverlay" id="sbOverlay"></div>

  <div class="modalWrap" id="modalWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHd">
        <h3 id="modalTitle">Modal</h3>
        <button class="closeBtn" id="modalClose">‚úï</button>
      </div>
      <div class="modalBd" id="modalBody"></div>
      <div class="modalFt" id="modalFoot"></div>
    </div>
  </div>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sb-top">
        <div class="logo">WH</div>
        <div class="sb-title">
          <p class="t">WorkHub</p>
          <p class="s">Premium UI ‚Ä¢ Single-page ‚Ä¢ One-command run</p>
        </div>

        <button class="themeToggle" id="themeToggle" title="Toggle theme">
          <span id="themeLabel">Dark</span>
          <span class="toggleDot"></span>
        </button>
      </div>

      <nav class="sb-nav">
        <button class="navbtn active" data-page="browseBusinesses">
          <div class="navleft"><span class="navicon">üè¢</span> Businesses</div>
          <span class="navmeta" id="metaBusinesses">0</span>
        </button>
        <button class="navbtn" data-page="browseWorkers">
          <div class="navleft"><span class="navicon">üßë‚Äçüîß</span> Workers</div>
          <span class="navmeta" id="metaWorkers">0</span>
        </button>
        <button class="navbtn" data-page="auth">
          <div class="navleft"><span class="navicon">üîê</span> Login / Register</div>
          <span class="navmeta">Account</span>
        </button>
        <button class="navbtn" data-page="owner">
          <div class="navleft"><span class="navicon">üßæ</span> Owner Panel</div>
          <span class="navmeta">Manage</span>
        </button>
        <button class="navbtn" data-page="worker">
          <div class="navleft"><span class="navicon">‚ö°</span> Worker Panel</div>
          <span class="navmeta">Profile</span>
        </button>
      </nav>

      <div class="sb-bottom">
        <div class="pill" id="healthPill"><span class="dot"></span> API: checking‚Ä¶</div>
        <div class="pill" id="whoPill">Not logged in</div>
        <div class="row" style="gap:8px;">
          <button class="btn ghost" id="btnRefresh">Refresh</button>
          <button class="btn danger" id="btnLogout" disabled>Logout</button>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <div class="topLeft">
          <button class="hamburger" id="hamburger">‚ò∞ Menu</button>
          <div>
            <h1 id="pageTitle">Businesses</h1>
            <p id="pageSub">Browse and manage businesses in a clean premium dashboard.</p>
          </div>
        </div>

        <div class="topActions">
          <span class="kpi" id="countBadge">0 items</span>
          <button class="btn primary" id="btnPrimaryAction">New</button>
        </div>
      </div>

      <div class="content">
        <!-- Page: Businesses -->
        <section id="page-browseBusinesses">
          <!-- KPI cards -->
          <div class="kpis">
            <div class="kpiCard">
              <div class="kpiLabel">Total Businesses</div>
              <div class="kpiValue" id="kpiBizTotal">0</div>
              <div class="kpiHint">All businesses available</div>
            </div>
            <div class="kpiCard">
              <div class="kpiLabel">Locations</div>
              <div class="kpiValue" id="kpiBizLocations">0</div>
              <div class="kpiHint">Unique locations count</div>
            </div>
            <div class="kpiCard">
              <div class="kpiLabel">Categories</div>
              <div class="kpiValue" id="kpiBizCategories">0</div>
              <div class="kpiHint">Unique categories count</div>
            </div>
            <div class="kpiCard">
              <div class="kpiLabel">My Businesses</div>
              <div class="kpiValue" id="kpiMyBiz">0</div>
              <div class="kpiHint">Owned by you (Owner)</div>
            </div>
          </div>

          <div class="controls">
            <div class="leftControls">
              <div class="field">
                <label>Search</label>
                <input id="bizSearch" placeholder="Search business name, category, location‚Ä¶">
              </div>
              <div class="field">
                <label>Sort</label>
                <select id="bizSort">
                  <option value="name_asc">Name (A‚ÜíZ)</option>
                  <option value="name_desc">Name (Z‚ÜíA)</option>
                  <option value="location_asc">Location (A‚ÜíZ)</option>
                </select>
              </div>
            </div>
            <div class="rightControls">
              <div class="hint">Tip: Login as Worker to ‚ÄúRequest to Join‚Äù.</div>
            </div>
          </div>
          <div class="list" id="bizList"></div>
        </section>

        <!-- Page: Workers -->
        <section id="page-browseWorkers" class="hide">
          <!-- KPI cards -->
          <div class="kpis">
            <div class="kpiCard">
              <div class="kpiLabel">Total Workers</div>
              <div class="kpiValue" id="kpiWorkerTotal">0</div>
              <div class="kpiHint">All workers in the list</div>
            </div>
            <div class="kpiCard">
              <div class="kpiLabel">Ready</div>
              <div class="kpiValue" id="kpiWorkerReady">0</div>
              <div class="kpiHint">Available to work</div>
            </div>
            <div class="kpiCard">
              <div class="kpiLabel">Busy</div>
              <div class="kpiValue" id="kpiWorkerBusy">0</div>
              <div class="kpiHint">Currently engaged</div>
            </div>
            <div class="kpiCard">
              <div class="kpiLabel">Avg Rating</div>
              <div class="kpiValue" id="kpiWorkerAvg">0.0</div>
              <div class="kpiHint">Average across workers</div>
            </div>
          </div>

          <div class="controls">
            <div class="leftControls">
              <div class="field">
                <label>Search</label>
                <input id="workerSearch" placeholder="Search name, skills, location‚Ä¶">
              </div>

              <div class="field">
                <label>Business filter</label>
                <select id="filterBusiness">
                  <option value="">All businesses</option>
                </select>
              </div>

              <div class="field">
                <label>Status filter</label>
                <select id="filterStatus">
                  <option value="">All</option>
                  <option value="ready">Ready</option>
                  <option value="busy">Busy</option>
                  <option value="pending">Pending</option>
                </select>
              </div>

              <div class="field">
                <label>Sort</label>
                <select id="workerSort">
                  <option value="rating_desc">Rating (High‚ÜíLow)</option>
                  <option value="rating_asc">Rating (Low‚ÜíHigh)</option>
                  <option value="name_asc">Name (A‚ÜíZ)</option>
                  <option value="name_desc">Name (Z‚ÜíA)</option>
                </select>
              </div>
            </div>

            <div class="rightControls">
              <div class="hint">Tip: Login to rate workers with reviews.</div>
            </div>
          </div>
          <div class="list" id="workerList"></div>
        </section>

        <!-- Page: Auth -->
        <section id="page-auth" class="hide">
          <div class="row">
            <div class="field">
              <label>Email</label>
              <input id="loginEmail" placeholder="admin@workhub.local"/>
            </div>
            <div class="field">
              <label>Password</label>
              <input id="loginPass" type="password" placeholder="admin123"/>
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <button class="btn primary" id="btnLogin">Login</button>
            <button class="btn" id="btnQuickAdmin">Use Admin Demo</button>
          </div>

          <div style="height:14px;"></div>

          <div class="row">
            <div class="field">
              <label>Register as</label>
              <select id="regRole">
                <option value="owner">Business Owner</option>
                <option value="worker">Worker</option>
              </select>
            </div>
            <div class="field">
              <label>Name</label>
              <input id="regName" placeholder="Full name"/>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Email</label>
              <input id="regEmail" placeholder="name@example.com"/>
            </div>
            <div class="field">
              <label>Phone (optional)</label>
              <input id="regPhone" placeholder="98765‚Ä¶"/>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Password</label>
              <input id="regPass" type="password" placeholder="Minimum 4 characters"/>
            </div>
          </div>

          <button class="btn primary" id="btnRegister">Create account</button>

          <div style="height:12px;"></div>
          <div class="hint">Admin demo: <b>admin@workhub.local</b> / <b>admin123</b></div>
        </section>

        <!-- Page: Owner -->
        <section id="page-owner" class="hide">
          <div class="hint" style="margin-bottom:10px;">Owner tools: create businesses and approve worker requests.</div>
          <div class="row">
            <div class="field">
              <label>Business name</label>
              <input id="bizName" placeholder="e.g., Sri Lakshmi Constructions"/>
            </div>
            <div class="field">
              <label>Category</label>
              <input id="bizCat" placeholder="Construction / Hotel / Retail‚Ä¶"/>
            </div>
            <div class="field">
              <label>Location</label>
              <input id="bizLoc" placeholder="Vizag"/>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <button class="btn primary" id="btnCreateBiz">Create business</button>
            <button class="btn" id="btnLoadRequests">Load pending requests</button>
          </div>

          <div style="height:14px;"></div>
          <div class="list" id="requestList"></div>
        </section>

        <!-- Page: Worker -->
        <section id="page-worker" class="hide">
          <div class="hint" style="margin-bottom:10px;">Worker tools: update profile and availability status.</div>

          <div class="row">
            <div class="field">
              <label>Skills (comma separated)</label>
              <input id="wpSkills" placeholder="Plumber, Electrician, Painter‚Ä¶"/>
            </div>
            <div class="field">
              <label>Experience (years)</label>
              <input id="wpExp" type="number" min="0" value="0"/>
            </div>
            <div class="field">
              <label>Location</label>
              <input id="wpLoc" placeholder="Vizag / Gajuwaka / MVP‚Ä¶"/>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <button class="btn primary" id="btnSaveProfile">Save profile</button>
          </div>

          <div style="height:14px;"></div>

          <div class="row">
            <div class="field">
              <label>Availability status</label>
              <select id="wpStatus">
                <option value="pending">Pending</option>
                <option value="ready">Ready</option>
                <option value="busy">Busy</option>
              </select>
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button class="btn" id="btnSetStatus">Update status</button>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <script>
    /* =========================
       Theme toggle (persist)
    ========================== */
    const THEME_KEY = "workhub_theme";
    function setTheme(mode){
      document.documentElement.setAttribute("data-theme", mode);
      localStorage.setItem(THEME_KEY, mode);
      const label = document.getElementById("themeLabel");
      if (label) label.textContent = (mode === "light") ? "Light" : "Dark";
    }
    function toggleTheme(){
      const cur = localStorage.getItem(THEME_KEY) || "dark";
      setTheme(cur === "dark" ? "light" : "dark");
    }
    (function initTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      if (saved === "light" || saved === "dark") setTheme(saved);
      else setTheme("dark");
      document.getElementById("themeToggle").addEventListener("click", toggleTheme);
    })();

    /* =========================
       Mobile drawer sidebar
    ========================== */
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("sbOverlay");
    const hamburger = document.getElementById("hamburger");

    function closeSidebar(){
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    }
    function openSidebar(){
      sidebar.classList.add("open");
      overlay.classList.add("show");
    }
    hamburger.addEventListener("click", () => {
      if (sidebar.classList.contains("open")) closeSidebar();
      else openSidebar();
    });
    overlay.addEventListener("click", closeSidebar);

    /* =========================
       Helpers
    ========================== */
    const el = (id) => document.getElementById(id);

    const api = async (path, opts={}) => {
      const r = await fetch(path, {
        headers: { "Content-Type": "application/json" },
        ...opts
      });
      const data = await r.json().catch(() => ({}));
      if (!r.ok) throw new Error(data.error || ("Request failed: " + r.status));
      return data;
    };

    const state = {
      user: null,
      businesses: [],
      workers: [],
      page: "browseBusinesses"
    };

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /* =========================
       Toasts
    ========================== */
    function toast(type, title, message, ms=3200){
      const box = el("toasts");
      const t = document.createElement("div");
      t.className = "toast " + (type || "");
      const icon = type === "ok" ? "‚úì" : type === "bad" ? "!" : "‚ö†";
      t.innerHTML = `
        <div class="ticon">${icon}</div>
        <div>
          <h4>${escapeHtml(title)}</h4>
          <p>${escapeHtml(message)}</p>
        </div>
        <button class="x" aria-label="Close">‚úï</button>
      `;
      box.appendChild(t);

      const close = () => { if (t && t.parentNode) t.parentNode.removeChild(t); };
      t.querySelector(".x").addEventListener("click", close);
      setTimeout(close, ms);
    }

    /* =========================
       Modal
    ========================== */
    function openModal({ title, bodyHtml, actions=[] }){
      el("modalTitle").textContent = title || "Modal";
      el("modalBody").innerHTML = bodyHtml || "";
      const foot = el("modalFoot");
      foot.innerHTML = "";

      actions.forEach(a => {
        const b = document.createElement("button");
        b.className = "btn " + (a.variant || "");
        b.textContent = a.label || "OK";
        b.addEventListener("click", async () => {
          try{
            if (a.onClick) await a.onClick();
          } finally {
            if (a.closeOnClick !== false) closeModal();
          }
        });
        foot.appendChild(b);
      });

      el("modalWrap").style.display = "flex";
      el("modalWrap").setAttribute("aria-hidden", "false");
    }

    function closeModal(){
      el("modalWrap").style.display = "none";
      el("modalWrap").setAttribute("aria-hidden", "true");
      el("modalBody").innerHTML = "";
      el("modalFoot").innerHTML = "";
    }
    el("modalClose").addEventListener("click", closeModal);
    el("modalWrap").addEventListener("click", (e) => {
      if (e.target === el("modalWrap")) closeModal();
    });

    /* =========================
       Nav + Pages
    ========================== */
    function refreshCountBadges(){
      el("metaBusinesses").textContent = String(state.businesses.length || 0);
      el("metaWorkers").textContent = String(state.workers.length || 0);

      const count = state.page === "browseWorkers"
        ? state.workers.length
        : state.page === "browseBusinesses"
          ? state.businesses.length
          : 0;

      el("countBadge").textContent = `${count} items`;
    }

    function updateKPIs(){
      // Businesses KPIs
      const biz = state.businesses || [];
      const locs = new Set(biz.map(b => (b.location || "").trim().toLowerCase()).filter(Boolean));
      const cats = new Set(biz.map(b => (b.category || "").trim().toLowerCase()).filter(Boolean));
      const myBiz = (state.user && state.user.role === "owner")
        ? biz.filter(b => Number(b.owner_id) === Number(state.user.id)).length
        : 0;

      el("kpiBizTotal").textContent = String(biz.length);
      el("kpiBizLocations").textContent = String(locs.size);
      el("kpiBizCategories").textContent = String(cats.size);
      el("kpiMyBiz").textContent = String(myBiz);

      // Workers KPIs
      const workers = state.workers || [];
      const ready = workers.filter(w => w.status === "ready").length;
      const busy = workers.filter(w => w.status === "busy").length;
      const avg = workers.length
        ? (workers.reduce((s,w)=> s + Number(w.avg_rating || 0), 0) / workers.length)
        : 0;

      el("kpiWorkerTotal").textContent = String(workers.length);
      el("kpiWorkerReady").textContent = String(ready);
      el("kpiWorkerBusy").textContent = String(busy);
      el("kpiWorkerAvg").textContent = avg.toFixed(1);
    }

    function setPage(page){
      state.page = page;

      document.querySelectorAll(".navbtn").forEach(b => {
        b.classList.toggle("active", b.dataset.page === page);
      });

      document.querySelectorAll("[id^='page-']").forEach(s => s.classList.add("hide"));
      el("page-" + page).classList.remove("hide");

      const titleMap = {
        browseBusinesses: ["Businesses", "Browse and manage businesses in a clean premium dashboard."],
        browseWorkers: ["Workers", "Find workers by skill/status and rate them with reviews."],
        auth: ["Login / Register", "Access your role-based account and start using WorkHub."],
        owner: ["Owner Panel", "Create businesses and approve worker join requests."],
        worker: ["Worker Panel", "Update your profile, skills, and availability status."]
      };
      el("pageTitle").textContent = titleMap[page]?.[0] || "WorkHub";
      el("pageSub").textContent = titleMap[page]?.[1] || "";

      const primary = el("btnPrimaryAction");
      primary.onclick = null;

      if (page === "browseBusinesses"){
        primary.textContent = "New Business";
        primary.onclick = () => openCreateBusinessModal();
      } else if (page === "browseWorkers"){
        primary.textContent = "Refresh";
        primary.onclick = () => refreshWorkers();
      } else if (page === "auth"){
        primary.textContent = "Login";
        primary.onclick = () => el("btnLogin").click();
      } else if (page === "owner"){
        primary.textContent = "Create";
        primary.onclick = () => openCreateBusinessModal();
      } else if (page === "worker"){
        primary.textContent = "Save";
        primary.onclick = () => el("btnSaveProfile").click();
      } else {
        primary.textContent = "New";
      }

      refreshCountBadges();
      updateKPIs();
      closeSidebar(); // auto close on navigation (mobile)
    }

    document.querySelectorAll(".navbtn").forEach(b => {
      b.addEventListener("click", () => setPage(b.dataset.page));
    });

    /* =========================
       Health + User
    ========================== */
    function setHealth(ok){
      el("healthPill").innerHTML = ok
        ? `<span class="dot ok"></span> API: OK`
        : `<span class="dot bad"></span> API: DOWN`;
    }

    function roleName(role){
      if (role === "admin") return "Admin";
      if (role === "owner") return "Owner";
      if (role === "worker") return "Worker";
      return role;
    }

    function updateWho(){
      el("btnLogout").disabled = !state.user;
      el("whoPill").textContent = state.user
        ? `${roleName(state.user.role)} ‚Ä¢ ${state.user.name} (id:${state.user.id})`
        : "Not logged in";
    }

    /* =========================
       Skeleton
    ========================== */
    function renderSkeleton(targetId, n=4){
      const box = el(targetId);
      box.innerHTML = "";
      for (let i=0;i<n;i++){
        const s = document.createElement("div");
        s.className = "skeleton";
        s.innerHTML = `
          <div class="sk-line w1"></div>
          <div class="sk-line w2"></div>
          <div class="sk-line w3"></div>
        `;
        box.appendChild(s);
      }
    }

    /* =========================
       Businesses
    ========================== */
    function openCreateBusinessModal(){
      if (!state.user || state.user.role !== "owner"){
        toast("warn", "Owner required", "Login as a Business Owner to create a business.");
        setPage("auth");
        return;
      }

      openModal({
        title: "Create new business",
        bodyHtml: `
          <div class="row">
            <div class="field">
              <label>Business name</label>
              <input id="mBizName" placeholder="e.g., Sri Lakshmi Constructions"/>
            </div>
            <div class="field">
              <label>Category</label>
              <input id="mBizCat" placeholder="Construction / Hotel / Retail‚Ä¶"/>
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label>Location</label>
              <input id="mBizLoc" placeholder="Vizag"/>
            </div>
          </div>
          <div class="hint">This will be owned by your current account.</div>
        `,
        actions: [
          { label: "Cancel", variant: "ghost" },
          {
            label: "Create",
            variant: "primary",
            onClick: async () => {
              const name = el("mBizName").value.trim();
              const category = el("mBizCat").value.trim();
              const location = el("mBizLoc").value.trim();

              await api("/api/owner/businesses", {
                method:"POST",
                body: JSON.stringify({ owner_id: state.user.id, name, category, location })
              });

              toast("ok", "Business created", "Your business is now live.");
              await refreshBusinesses();
              if (state.page !== "browseBusinesses") setPage("browseBusinesses");
            }
          }
        ]
      });
    }

    function applyBizFilters(items){
      const q = el("bizSearch").value.trim().toLowerCase();
      const sort = el("bizSort").value;

      let out = items.filter(b => {
        if (!q) return true;
        const hay = `${b.name||""} ${b.category||""} ${b.location||""}`.toLowerCase();
        return hay.includes(q);
      });

      if (sort === "name_asc") out.sort((a,b) => (a.name||"").localeCompare(b.name||""));
      if (sort === "name_desc") out.sort((a,b) => (b.name||"").localeCompare(a.name||""));
      if (sort === "location_asc") out.sort((a,b) => (a.location||"").localeCompare(b.location||""));

      return out;
    }

    function renderBusinesses(){
      const box = el("bizList");
      const items = applyBizFilters(state.businesses);

      el("metaBusinesses").textContent = String(items.length);
      if (state.page === "browseBusinesses") el("countBadge").textContent = `${items.length} items`;

      box.innerHTML = "";
      if (!items.length){
        box.innerHTML = `<div class="hint">No businesses match your search. Create one in Owner Panel.</div>`;
        return;
      }

      items.forEach(b => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div>
            <div class="titleRow">
              <h3>${escapeHtml(b.name)}</h3>
              <span class="badge brand">${escapeHtml(b.category || "Business")}</span>
            </div>
            <p>
              Location: ${escapeHtml(b.location || "‚Äî")}<br/>
              Owner: ${escapeHtml(b.owner_name || "‚Äî")}
            </p>
          </div>
          <div class="actions">
            ${
              state.user && state.user.role === "worker"
                ? `<button class="btn primary" data-join="${b.id}">Request to Join</button>`
                : `<span class="badge">Browse</span>`
            }
          </div>
        `;
        box.appendChild(div);
      });

      box.querySelectorAll("[data-join]").forEach(btn => {
        btn.addEventListener("click", async () => {
          try{
            if (!state.user || state.user.role !== "worker") throw new Error("Login as a Worker first.");
            const business_id = Number(btn.dataset.join);

            openModal({
              title: "Confirm request",
              bodyHtml: `
                <div class="hint">Send a join request to this business?</div>
                <div style="height:10px;"></div>
                <div class="badge brand">Business ID: ${escapeHtml(business_id)}</div>
              `,
              actions: [
                { label:"Cancel", variant:"ghost" },
                {
                  label:"Send Request",
                  variant:"primary",
                  onClick: async () => {
                    await api("/api/worker/register_business", {
                      method:"POST",
                      body: JSON.stringify({ worker_user_id: state.user.id, business_id })
                    });
                    toast("ok", "Request sent", "Owner will approve your request soon.");
                  }
                }
              ]
            });

          }catch(e){
            toast("bad", "Failed", e.message);
          }
        });
      });
    }

    async function refreshBusinesses(){
      renderSkeleton("bizList", 4);
      const data = await api("/api/businesses");
      state.businesses = data.items || [];

      const sel = el("filterBusiness");
      const keep = sel.value;
      sel.innerHTML = `<option value="">All businesses</option>` + state.businesses.map(b =>
        `<option value="${b.id}">${escapeHtml(b.name)} ‚Ä¢ ${escapeHtml(b.location || "‚Äî")}</option>`
      ).join("");
      sel.value = keep || "";

      renderBusinesses();
      refreshCountBadges();
      updateKPIs();
    }

    /* =========================
       Workers
    ========================== */
    function statusBadge(s){
      if (s === "ready") return `<span class="badge ok">Ready</span>`;
      if (s === "busy") return `<span class="badge bad">Busy</span>`;
      return `<span class="badge warn">Pending</span>`;
    }
    function stars(avg){
      const a = Number(avg || 0);
      const full = Math.max(0, Math.min(5, Math.round(a)));
      return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ".slice(0, full) + "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ".slice(0, 5-full);
    }

    function applyWorkerFilters(items){
      const q = el("workerSearch").value.trim().toLowerCase();
      const business_id = el("filterBusiness").value;
      const status = el("filterStatus").value;
      const sort = el("workerSort").value;

      let out = items.filter(w => {
        if (business_id && String(w.business_id || "") !== String(business_id)) return false;
        if (status && String(w.status || "") !== String(status)) return false;

        if (!q) return true;
        const hay = `${w.name||""} ${w.skills||""} ${w.location||""}`.toLowerCase();
        return hay.includes(q);
      });

      if (sort === "rating_desc") out.sort((a,b) => (Number(b.avg_rating||0) - Number(a.avg_rating||0)));
      if (sort === "rating_asc") out.sort((a,b) => (Number(a.avg_rating||0) - Number(b.avg_rating||0)));
      if (sort === "name_asc") out.sort((a,b) => (a.name||"").localeCompare(b.name||""));
      if (sort === "name_desc") out.sort((a,b) => (b.name||"").localeCompare(a.name||""));

      return out;
    }

    function renderWorkers(){
      const box = el("workerList");
      const items = applyWorkerFilters(state.workers);

      el("metaWorkers").textContent = String(items.length);
      if (state.page === "browseWorkers") el("countBadge").textContent = `${items.length} items`;

      box.innerHTML = "";
      if (!items.length){
        box.innerHTML = `<div class="hint">No workers found with current filters.</div>`;
        return;
      }

      items.forEach(w => {
        const avg = Number(w.avg_rating || 0).toFixed(1);
        const cnt = Number(w.rating_count || 0);

        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div>
            <div class="titleRow">
              <h3>${escapeHtml(w.name)}</h3>
              ${statusBadge(w.status)}
              <span class="badge brand">${stars(avg)} ‚Ä¢ ${escapeHtml(avg)} (${escapeHtml(cnt)})</span>
            </div>
            <p>
              Skills: ${escapeHtml(w.skills || "‚Äî")}<br/>
              Exp: ${escapeHtml(String(w.experience_years ?? 0))} yrs ‚Ä¢ Location: ${escapeHtml(w.location || "‚Äî")}
            </p>
          </div>
          <div class="actions">
            <span class="badge">üìû ${escapeHtml(w.phone || "‚Äî")}</span>
            <span class="badge">‚úâÔ∏è ${escapeHtml(w.email || "‚Äî")}</span>
            ${state.user ? `<button class="btn primary" data-rate="${w.user_id}">Rate</button>` : ``}
          </div>
        `;
        box.appendChild(div);
      });

      box.querySelectorAll("[data-rate]").forEach(btn => {
        btn.addEventListener("click", () => {
          if (!state.user){
            toast("warn", "Login required", "Please login to submit ratings.");
            setPage("auth");
            return;
          }
          const worker_user_id = Number(btn.dataset.rate);

          openModal({
            title: "Rate worker",
            bodyHtml: `
              <div class="row">
                <div class="field">
                  <label>Stars</label>
                  <select id="mRateStars">
                    <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5)</option>
                    <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4)</option>
                    <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3)</option>
                    <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2)</option>
                    <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1)</option>
                  </select>
                </div>
                <div class="field">
                  <label>Review (optional)</label>
                  <input id="mRateText" placeholder="Write a short review‚Ä¶"/>
                </div>
              </div>
              <div class="hint">Your rating helps businesses find trusted workers.</div>
            `,
            actions: [
              { label:"Cancel", variant:"ghost" },
              {
                label:"Submit",
                variant:"primary",
                onClick: async () => {
                  const rating = Number(el("mRateStars").value);
                  const review = (el("mRateText").value || "").trim();

                  await api("/api/ratings", {
                    method:"POST",
                    body: JSON.stringify({
                      worker_user_id,
                      rater_user_id: state.user.id,
                      rating,
                      review
                    })
                  });

                  toast("ok", "Rating submitted", "Thanks! Your review has been saved.");
                  await refreshWorkers();
                }
              }
            ]
          });
        });
      });

      updateKPIs();
    }

    async function refreshWorkers(){
      renderSkeleton("workerList", 5);

      const status = el("filterStatus").value;
      const business_id = el("filterBusiness").value;

      const qs = new URLSearchParams();
      if (status) qs.set("status", status);
      if (business_id) qs.set("business_id", business_id);

      const data = await api(`/api/workers?${qs.toString()}`);
      state.workers = data.items || [];

      renderWorkers();
      refreshCountBadges();
      updateKPIs();
    }

    /* =========================
       Owner Requests
    ========================== */
    function renderRequests(items){
      const box = el("requestList");
      box.innerHTML = "";

      if (!items.length){
        box.innerHTML = `<div class="hint">No pending requests.</div>`;
        return;
      }

      items.forEach(it => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div>
            <div class="titleRow">
              <h3>${escapeHtml(it.worker_name)}</h3>
              <span class="badge warn">Pending</span>
            </div>
            <p>
              Business: <b>${escapeHtml(it.business_name)}</b><br/>
              Email: ${escapeHtml(it.email || "-")} ‚Ä¢ Phone: ${escapeHtml(it.phone || "-")}
            </p>
          </div>
          <div class="actions">
            <button class="btn primary" data-approve="${it.request_id}">Approve</button>
          </div>
        `;
        box.appendChild(div);
      });

      box.querySelectorAll("[data-approve]").forEach(btn => {
        btn.addEventListener("click", async () => {
          try{
            if (!state.user || state.user.role !== "owner") throw new Error("Login as an Owner first.");
            const request_id = Number(btn.dataset.approve);

            openModal({
              title: "Approve worker request",
              bodyHtml: `<div class="hint">Approve this worker request?</div>`,
              actions: [
                { label:"Cancel", variant:"ghost" },
                {
                  label:"Approve",
                  variant:"primary",
                  onClick: async () => {
                    await api("/api/owner/approve_request", {
                      method:"POST",
                      body: JSON.stringify({ owner_id: state.user.id, request_id })
                    });
                    toast("ok", "Approved", "Worker is approved for the business.");
                    await loadOwnerRequests();
                  }
                }
              ]
            });
          }catch(e){
            toast("bad", "Failed", e.message);
          }
        });
      });
    }

    async function loadOwnerRequests(){
      if (!state.user || state.user.role !== "owner"){
        toast("warn", "Owner required", "Login as Owner to load requests.");
        return;
      }
      renderSkeleton("requestList", 3);
      const data = await api(`/api/owner/pending_requests?owner_id=${state.user.id}`);
      renderRequests(data.items || []);
    }

    /* =========================
       Auth + Worker/Owner actions
    ========================== */
    el("btnQuickAdmin").addEventListener("click", () => {
      el("loginEmail").value = "admin@workhub.local";
      el("loginPass").value = "admin123";
      toast("ok", "Filled demo credentials", "Now click Login.");
    });

    el("btnLogin").addEventListener("click", async () => {
      try{
        const email = el("loginEmail").value.trim();
        const password = el("loginPass").value;

        const data = await api("/api/login", {
          method:"POST",
          body: JSON.stringify({ email, password })
        });

        state.user = data.user;
        updateWho();
        toast("ok", "Logged in", `Welcome ${data.user.name} (${roleName(data.user.role)})`);

        if (state.user.role === "owner") setPage("owner");
        else if (state.user.role === "worker") setPage("worker");
        else setPage("browseBusinesses");

        await refreshAll();
      }catch(e){
        toast("bad", "Login failed", e.message);
      }
    });

    el("btnRegister").addEventListener("click", async () => {
      try{
        const role = el("regRole").value;
        const name = el("regName").value.trim();
        const email = el("regEmail").value.trim();
        const phone = el("regPhone").value.trim();
        const password = el("regPass").value;

        const data = await api("/api/register", {
          method:"POST",
          body: JSON.stringify({ role, name, email, phone, password })
        });

        toast("ok", "Account created", `Created user: ${data.user.name}. Now login.`);
      }catch(e){
        toast("bad", "Register failed", e.message);
      }
    });

    el("btnLogout").addEventListener("click", () => {
      state.user = null;
      updateWho();
      toast("ok", "Logged out", "You are now logged out.");
      setPage("browseBusinesses");
    });

    el("btnCreateBiz").addEventListener("click", async () => {
      if (!state.user || state.user.role !== "owner"){
        toast("warn", "Owner required", "Login as Owner to create business.");
        setPage("auth");
        return;
      }
      try{
        const name = el("bizName").value.trim();
        const category = el("bizCat").value.trim();
        const location = el("bizLoc").value.trim();

        await api("/api/owner/businesses", {
          method:"POST",
          body: JSON.stringify({ owner_id: state.user.id, name, category, location })
        });

        toast("ok", "Business created", "Your business is now live.");
        el("bizName").value = "";
        await refreshBusinesses();
      }catch(e){
        toast("bad", "Create failed", e.message);
      }
    });

    el("btnLoadRequests").addEventListener("click", loadOwnerRequests);

    el("btnSaveProfile").addEventListener("click", async () => {
      try{
        if (!state.user || state.user.role !== "worker") throw new Error("Login as Worker first.");
        const skills = el("wpSkills").value.trim();
        const experience_years = Number(el("wpExp").value || 0);
        const location = el("wpLoc").value.trim();

        await api("/api/worker/profile", {
          method:"POST",
          body: JSON.stringify({ user_id: state.user.id, skills, experience_years, location })
        });

        toast("ok", "Saved", "Worker profile updated.");
        await refreshWorkers();
      }catch(e){
        toast("bad", "Save failed", e.message);
      }
    });

    el("btnSetStatus").addEventListener("click", async () => {
      try{
        if (!state.user || state.user.role !== "worker") throw new Error("Login as Worker first.");
        const status = el("wpStatus").value;

        await api("/api/worker/status", {
          method:"POST",
          body: JSON.stringify({ user_id: state.user.id, status })
        });

        toast("ok", "Updated", "Status updated successfully.");
        await refreshWorkers();
      }catch(e){
        toast("bad", "Update failed", e.message);
      }
    });

    /* Filters events */
    el("bizSearch").addEventListener("input", renderBusinesses);
    el("bizSort").addEventListener("change", renderBusinesses);

    el("workerSearch").addEventListener("input", renderWorkers);
    el("filterBusiness").addEventListener("change", refreshWorkers);
    el("filterStatus").addEventListener("change", refreshWorkers);
    el("workerSort").addEventListener("change", renderWorkers);

    /* Refresh */
    el("btnRefresh").addEventListener("click", async () => {
      toast("ok", "Refreshing", "Updating businesses and workers‚Ä¶", 1500);
      await refreshAll();
    });

    async function checkHealth(){
      try{ await api("/api/health"); setHealth(true); }
      catch(e){ setHealth(false); }
    }

    async function refreshAll(){
      await checkHealth();
      await refreshBusinesses();
      await refreshWorkers();
      refreshCountBadges();
      updateKPIs();
    }

    (async function init(){
      updateWho();
      setPage("browseBusinesses");
      await refreshAll();
      toast("ok", "WorkHub ready", "Premium UI + mobile drawer loaded.", 2200);
    })();
  </script>
</body>
</html>
