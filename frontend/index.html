<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WorkHub ‚Ä¢ Find Work. Hire Fast.</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#070A12;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.18);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.64);
      --muted2: rgba(255,255,255,.48);
      --shadow: 0 18px 50px rgba(0,0,0,.55);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);

      --a1:#7c3aed;
      --a2:#22d3ee;
      --a3:#38bdf8;

      --ok:#22c55e;
      --warn:#f59e0b;
      --bad:#fb7185;

      --r1:16px;
      --r2:22px;
      --r3:28px;

      --max: 1120px;
    }

    html[data-theme="light"]{
      --bg:#f6f7fb;
      --panel: rgba(255,255,255,.72);
      --panel2: rgba(255,255,255,.86);
      --stroke: rgba(15,23,42,.10);
      --stroke2: rgba(15,23,42,.16);
      --text: rgba(15,23,42,.92);
      --muted: rgba(15,23,42,.66);
      --muted2: rgba(15,23,42,.52);
      --shadow: 0 18px 50px rgba(15,23,42,.12);
      --shadow2: 0 10px 28px rgba(15,23,42,.10);
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 500px at 18% 8%, rgba(124,58,237,.28), transparent 55%),
        radial-gradient(900px 520px at 78% 16%, rgba(34,211,238,.22), transparent 55%),
        radial-gradient(820px 520px at 70% 78%, rgba(56,189,248,.16), transparent 58%),
        linear-gradient(180deg, var(--bg), var(--bg));
      min-height: 100vh;
    }

    a{ color: inherit; text-decoration: none; }
    .hide{ display:none !important; }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 18px 16px 34px;
    }

    /* Topbar */
    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding: 14px 14px;
      border-radius: var(--r2);
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
      position: sticky;
      top: 12px;
      z-index: 10;
      backdrop-filter: blur(14px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 240px;
    }
    .logo{
      width:44px; height:44px;
      border-radius: 16px;
      background:
        radial-gradient(12px 12px at 30% 28%, rgba(255,255,255,.95), rgba(255,255,255,.0) 65%),
        linear-gradient(135deg, rgba(124,58,237,1), rgba(34,211,238,1));
      box-shadow: 0 14px 40px rgba(124,58,237,.25);
      border: 1px solid rgba(255,255,255,.18);
      position: relative;
      overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      transform: rotate(20deg);
      animation: shine 3.4s ease-in-out infinite;
    }
    @keyframes shine{
      0%, 70%{ transform: translateX(-40%) rotate(20deg); opacity:0; }
      80%{ opacity:1; }
      100%{ transform: translateX(40%) rotate(20deg); opacity:0; }
    }

    .brand h1{
      font-size: 15px;
      line-height: 1.1;
      margin:0;
      letter-spacing: .2px;
      font-weight: 1000;
    }
    .brand p{
      margin: 4px 0 0;
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
    }

    .nav{
      display:flex;
      align-items:center;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .pill{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
      user-select:none;
    }
    .pill:hover{ transform: translateY(-1px); border-color: var(--stroke2); background: rgba(255,255,255,.06); }
    .pill.active{
      color: rgba(255,255,255,.95);
      background: linear-gradient(135deg, rgba(124,58,237,.28), rgba(34,211,238,.18));
      border-color: rgba(34,211,238,.32);
      box-shadow: 0 14px 34px rgba(34,211,238,.10);
    }
    html[data-theme="light"] .pill.active{ color: rgba(15,23,42,.92); }

    .right{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 240px;
      justify-content:flex-end;
    }

    .chip{
      font-size: 12px;
      font-weight: 900;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width: 8px; height:8px;
      border-radius:999px;
      background: rgba(255,255,255,.45);
    }
    .dot.on{ background: var(--ok); }

    .btn{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 12px;
      cursor:pointer;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: var(--stroke2); background: rgba(255,255,255,.08); }
    .btn.primary{
      border-color: rgba(34,211,238,.34);
      background: linear-gradient(135deg, rgba(124,58,237,.55), rgba(34,211,238,.35));
      box-shadow: 0 16px 36px rgba(124,58,237,.20);
    }
    .btn.danger{
      border-color: rgba(251,113,133,.34);
      background: linear-gradient(135deg, rgba(251,113,133,.36), rgba(245,158,11,.18));
    }

    /* Layout */
    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .brand, .right{ min-width:auto; }
      .topbar{ position: static; }
    }

    .card{
      border-radius: var(--r2);
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .cardHead{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
    }
    html[data-theme="light"] .cardHead{ border-bottom: 1px solid rgba(15,23,42,.08); }
    .title{
      margin:0;
      font-size: 14px;
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .sub{
      margin: 6px 0 0;
      font-size: 12px;
      color: var(--muted);
      font-weight: 650;
      line-height: 1.45;
    }
    .cardBody{ padding: 14px 16px 16px; }

    .hero{
      padding: 18px 16px;
      border-radius: var(--r2);
      background:
        radial-gradient(520px 200px at 18% 20%, rgba(124,58,237,.22), transparent 55%),
        radial-gradient(620px 260px at 78% 10%, rgba(34,211,238,.18), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
    }
    .hero h2{
      margin:0;
      font-size: 18px;
      letter-spacing: .2px;
      font-weight: 1000;
    }
    .hero p{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 12px;
      font-weight: 650;
      line-height: 1.55;
      max-width: 62ch;
    }
    .heroRow{
      margin-top: 14px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }

    .kpiRow{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    @media (max-width: 520px){
      .kpiRow{ grid-template-columns: 1fr; }
    }
    .kpi{
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
    }
    .kpi b{
      display:block;
      font-size: 12px;
      font-weight: 1000;
      letter-spacing:.2px;
    }
    .kpi span{
      display:block;
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 650;
      line-height: 1.4;
    }

    /* Inputs */
    .row{ display:flex; gap:10px; flex-wrap: wrap; }
    .field{ flex:1 1 220px; }
    label{
      display:block;
      font-size: 11px;
      color: var(--muted);
      font-weight: 800;
      margin-bottom: 8px;
      letter-spacing:.2px;
    }
    input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline: none;
      font-size: 13px;
      font-weight: 700;
      transition: border-color .16s ease, box-shadow .16s ease, transform .16s ease;
    }
    html[data-theme="light"] input, html[data-theme="light"] select, html[data-theme="light"] textarea{
      background: rgba(255,255,255,.75);
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(34,211,238,.35);
      box-shadow: 0 0 0 3px rgba(34,211,238,.12);
    }
    textarea{ min-height: 92px; resize: vertical; }

    .hint{
      font-size: 12px;
      color: var(--muted2);
      font-weight: 650;
      line-height: 1.45;
    }

    /* Lists */
    .list{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }
    .item{
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      padding: 12px 12px;
      display:flex;
      gap: 12px;
      align-items:flex-start;
      justify-content: space-between;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
    }
    .item:hover{
      transform: translateY(-1px);
      border-color: var(--stroke2);
      background: rgba(255,255,255,.06);
    }

    .itemMain{ flex: 1 1 auto; min-width: 0; }
    .itemTitle{
      font-weight: 1000;
      font-size: 13px;
      margin:0;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .itemMeta{
      margin: 6px 0 0;
      font-size: 12px;
      color: var(--muted);
      font-weight: 650;
      line-height: 1.45;
    }

    .tag{
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 1000;
      border: 1px solid var(--stroke);
      color: var(--muted);
      background: rgba(0,0,0,.10);
    }
    .tag.ok{ border-color: rgba(34,197,94,.34); color: rgba(34,197,94,.95); background: rgba(34,197,94,.10); }
    .tag.warn{ border-color: rgba(245,158,11,.34); color: rgba(245,158,11,.95); background: rgba(245,158,11,.10); }
    .tag.bad{ border-color: rgba(251,113,133,.34); color: rgba(251,113,133,.95); background: rgba(251,113,133,.10); }

    .itemActions{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
      justify-content:flex-end;
      flex: 0 0 auto;
      padding-left: 6px;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.94);
      font-weight: 850;
      font-size: 12px;
      box-shadow: var(--shadow);
      max-width: min(560px, calc(100vw - 24px));
      display:none;
      z-index: 99;
    }
    html[data-theme="light"] .toast{ background: rgba(255,255,255,.82); color: rgba(15,23,42,.92); }

    .spinner{
      width: 14px; height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.22);
      border-top-color: rgba(34,211,238,.9);
      display:inline-block;
      animation: spin .8s linear infinite;
      vertical-align: -2px;
      margin-right: 8px;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    /* ===== Premium micro-interactions ===== */
    .pageFade{ animation: pageFade .18s ease; }
    @keyframes pageFade{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .item:active{ transform: translateY(0); }

    /* Better empty state */
    .empty{
      border:1px dashed var(--stroke2);
      background: rgba(255,255,255,.04);
      border-radius: var(--r2);
      padding: 18px;
      display:flex;
      gap: 14px;
      align-items:flex-start;
    }
    html[data-theme="light"] .empty{ background: rgba(255,255,255,.70); }

    .emptyIcon{
      width:44px; height:44px;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center;
      font-weight: 1000;
      flex:0 0 auto;
    }
    .empty h3{
      margin:0;
      font-size: 14px;
      font-weight: 1000;
    }
    .empty p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.45;
    }

    /* Inline validation */
    .err{
      border-color: rgba(251,113,133,.55) !important;
      box-shadow: 0 0 0 3px rgba(251,113,133,.14);
    }
    .help{
      font-size: 11px;
      color: rgba(251,113,133,.9);
      font-weight: 800;
      margin-top: 6px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>WorkHub</h1>
          <p>Hire faster ‚Ä¢ Find work smarter (Vizag-first)</p>
        </div>
      </div>

      <div class="nav">
        <div class="pill active" data-page="home">Home</div>
        <div class="pill" data-page="auth">Login</div>
        <div class="pill" data-page="browse">Browse</div>
        <div class="pill" data-page="owner">Owner Panel</div>
        <div class="pill" data-page="admin">Admin Panel</div>
      </div>

      <div class="right">
        <div class="chip" title="Backend status">
          <span class="dot" id="dotApi"></span>
          <span id="apiText">API: checking‚Ä¶</span>
        </div>
        <button class="btn" id="btnTheme" title="Toggle theme">Theme</button>
        <button class="btn danger hide" id="btnLogout">Logout</button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div>
        <div class="hero">
          <h2>One platform for businesses and workers.</h2>
          <p>
            WorkHub helps businesses discover reliable workers quickly, and helps workers showcase skills,
            availability, and reputation ‚Äî without middlemen.
          </p>
          <div class="heroRow">
            <button class="btn primary" id="ctaGetStarted">Get started</button>
            <button class="btn" id="ctaBrowse">Browse workers</button>
          </div>

          <div class="kpiRow">
            <div class="kpi">
              <b>Role-based</b>
              <span>Admin ‚Ä¢ Business Owner ‚Ä¢ Worker</span>
            </div>
            <div class="kpi">
              <b>Status system</b>
              <span>Pending ‚Üí Ready ‚Üí Busy</span>
            </div>
            <div class="kpi">
              <b>Trust signals</b>
              <span>Ratings + basic reviews (next)</span>
            </div>
          </div>
        </div>

        <!-- PAGES -->
        <div class="card" style="margin-top:14px;">
          <div class="cardHead">
            <div>
              <p class="title" id="pageTitle">Home</p>
              <p class="sub" id="pageSub">Welcome ‚Äî choose a panel to continue.</p>
            </div>
            <div class="hint" id="whoami">Not logged in</div>
          </div>
          <div class="cardBody">

            <!-- HOME -->
            <section id="page-home">
              <div class="hint">
                Use <b>Login</b> to access Owner/Admin tools, or go to <b>Browse</b> to view businesses and workers.
              </div>
            </section>

            <!-- AUTH -->
            <section id="page-auth" class="hide">
              <div class="row">
                <div class="card" style="flex:1 1 360px;">
                  <div class="cardHead">
                    <div>
                      <p class="title">Login</p>
                      <p class="sub">Sign in to continue.</p>
                    </div>
                  </div>
                  <div class="cardBody">
                    <div class="field">
                      <label>Email</label>
                      <input id="loginEmail" placeholder="you@example.com" autocomplete="username" />
                    </div>
                    <div class="field" style="margin-top:10px;">
                      <label>Password</label>
                      <input id="loginPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
                    </div>
                    <div class="row" style="margin-top:12px; align-items:center;">
                      <button class="btn primary" id="btnLogin">Login</button>
                      <div class="hint">Admin/Owner/Worker are supported.</div>
                    </div>
                  </div>
                </div>

                <div class="card" style="flex:1 1 360px;">
                  <div class="cardHead">
                    <div>
                      <p class="title">Register</p>
                      <p class="sub">Create account (Worker or Owner).</p>
                    </div>
                  </div>
                  <div class="cardBody">
                    <div class="row">
                      <div class="field">
                        <label>Full Name</label>
                        <input id="regName" placeholder="Your name" />
                      </div>
                      <div class="field">
                        <label>Role</label>
                        <select id="regRole">
                          <option value="worker">Worker</option>
                          <option value="owner">Business Owner</option>
                        </select>
                      </div>
                    </div>
                    <div class="field" style="margin-top:10px;">
                      <label>Email</label>
                      <input id="regEmail" placeholder="you@example.com" autocomplete="email" />
                    </div>
                    <div class="field" style="margin-top:10px;">
                      <label>Password</label>
                      <input id="regPass" type="password" placeholder="Create a password" autocomplete="new-password" />
                    </div>
                    <div class="row" style="margin-top:12px; align-items:center;">
                      <button class="btn primary" id="btnRegister">Create account</button>
                      <div class="hint">Admin is created from DB/seed only.</div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- BROWSE -->
            <section id="page-browse" class="hide">
              <div class="row" style="margin-bottom:12px;">
                <div class="field">
                  <label>Search (business / worker / skill)</label>
                  <input id="qBrowse" placeholder="e.g. electrician, plumber, salon‚Ä¶" />
                </div>
                <div class="field" style="max-width:240px;">
                  <label>Status filter</label>
                  <select id="statusFilter">
                    <option value="">All</option>
                    <option value="ready">Ready</option>
                    <option value="busy">Busy</option>
                    <option value="pending">Pending</option>
                  </select>
                </div>
                <div class="field" style="max-width:220px;">
                  <label>Business</label>
                  <select id="bizFilter">
                    <option value="">All businesses</option>
                  </select>
                </div>
              </div>

              <div class="card">
                <div class="cardHead">
                  <div>
                    <p class="title">Businesses</p>
                    <p class="sub">Select a business to see workers.</p>
                  </div>
                </div>
                <div class="cardBody">
                  <div class="list" id="bizList"></div>
                </div>
              </div>

              <div class="card" style="margin-top:12px;">
                <div class="cardHead">
                  <div>
                    <p class="title">Workers</p>
                    <p class="sub">Filter by business and availability.</p>
                  </div>
                </div>
                <div class="cardBody">
                  <div class="list" id="workerList"></div>
                </div>
              </div>
            </section>

            <!-- OWNER -->
            <section id="page-owner" class="hide">
              <div class="hint" style="margin-bottom:10px;">
                Owner tools: create businesses, review worker requests, and update worker status.
              </div>

              <div class="card" style="margin-bottom:12px;">
                <div class="cardHead">
                  <div>
                    <p class="title">Create Business</p>
                    <p class="sub">Add a business under your account.</p>
                  </div>
                </div>
                <div class="cardBody">
                  <div class="row">
                    <div class="field">
                      <label>Business name</label>
                      <input id="bizName" placeholder="e.g. Sri Sai Electricals" />
                    </div>
                    <div class="field">
                      <label>Category</label>
                      <input id="bizCategory" placeholder="e.g. Electrical, Catering, Salon" />
                    </div>
                  </div>
                  <div class="field" style="margin-top:10px;">
                    <label>Location</label>
                    <input id="bizLocation" placeholder="e.g. Dwaraka Nagar, Vizag" />
                  </div>
                  <div class="row" style="margin-top:12px;">
                    <button class="btn primary" id="btnCreateBiz">Create business</button>
                    <div class="hint">Business becomes visible in Browse.</div>
                  </div>
                </div>
              </div>

              <div class="card" style="margin-bottom:12px;">
                <div class="cardHead">
                  <div>
                    <p class="title">Worker Requests</p>
                    <p class="sub">Approve/reject workers who requested to join your business.</p>
                  </div>
                </div>
                <div class="cardBody">
                  <div class="list" id="ownerRequests"></div>
                </div>
              </div>

              <div class="card">
                <div class="cardHead">
                  <div>
                    <p class="title">Manage Workers</p>
                    <p class="sub">Update worker status (Ready/Busy) after hiring.</p>
                  </div>
                </div>
                <div class="cardBody">
                  <div class="list" id="ownerWorkers"></div>
                </div>
              </div>
            </section>

            <!-- ADMIN -->
            <section id="page-admin" class="hide">
              <div class="hint" style="margin-bottom:10px;">
                Admin tools: manage all businesses and approve worker registrations globally.
              </div>

              <div class="card" style="margin-bottom:12px;">
                <div class="cardHead">
                  <div>
                    <p class="title">All Businesses</p>
                    <p class="sub">View businesses across the platform.</p>
                  </div>
                </div>
                <div class="cardBody">
                  <div class="list" id="adminBiz"></div>
                </div>
              </div>

              <div class="card">
                <div class="cardHead">
                  <div>
                    <p class="title">Pending Workers</p>
                    <p class="sub">Approve/reject and set status.</p>
                  </div>
                </div>
                <div class="cardBody">
                  <div class="list" id="adminPending"></div>
                </div>
              </div>
            </section>

          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div>
        <div class="card">
          <div class="cardHead">
            <div>
              <p class="title">Quick Actions</p>
              <p class="sub">Common actions based on your role.</p>
            </div>
          </div>
          <div class="cardBody">
            <div class="row">
              <button class="btn" id="qaGoLogin">Login</button>
              <button class="btn" id="qaGoBrowse">Browse</button>
              <button class="btn" id="qaGoOwner">Owner Panel</button>
              <button class="btn" id="qaGoAdmin">Admin Panel</button>
            </div>
            <div style="margin-top:12px" class="hint">
              Tip: If you are a worker, register ‚Üí browse ‚Üí request to join a business ‚Üí wait for approval.
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px;">
          <div class="cardHead">
            <div>
              <p class="title">Worker Profile (self)</p>
              <p class="sub">Update your skills and availability (worker role only).</p>
            </div>
          </div>
          <div class="cardBody">
            <div class="field">
              <label>Skills (comma separated)</label>
              <input id="wSkills" placeholder="e.g. electrician, wiring, inverter" />
            </div>
            <div class="row" style="margin-top:10px;">
              <div class="field">
                <label>Experience</label>
                <input id="wExp" placeholder="e.g. 3 years" />
              </div>
              <div class="field">
                <label>Status</label>
                <select id="wStatus">
                  <option value="pending">Pending</option>
                  <option value="ready">Ready</option>
                  <option value="busy">Busy</option>
                </select>
              </div>
            </div>
            <div class="field" style="margin-top:10px;">
              <label>Location</label>
              <input id="wLoc" placeholder="e.g. MVP Colony, Vizag" />
            </div>
            <div class="row" style="margin-top:12px;">
              <button class="btn primary" id="btnSaveWorker">Save profile</button>
              <div class="hint">After approval, keep status as Ready to get hired faster.</div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px;">
          <div class="cardHead">
            <div>
              <p class="title">Worker ‚Üí Request Join</p>
              <p class="sub">Pick a business and request to join.</p>
            </div>
          </div>
          <div class="cardBody">
            <div class="field">
              <label>Business</label>
              <select id="joinBiz">
                <option value="">Select a business</option>
              </select>
            </div>
            <div class="row" style="margin-top:12px;">
              <button class="btn primary" id="btnJoinBiz">Request join</button>
              <div class="hint">Owner/Admin will approve.</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== Config =====
    const API_BASE = ""; // same origin (backend serves this file)

    // ===== Helpers =====
    const el = (id) => document.getElementById(id);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    function toast(msg, isErr=false){
      const t = el("toast");
      t.style.display = "block";
      t.innerHTML = (isErr ? "‚ö†Ô∏è " : "‚úÖ ") + msg;
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => t.style.display = "none", 2600);
    }

    function setActiveTab(page){
      $$(".pill").forEach(p => p.classList.toggle("active", p.dataset.page === page));
    }

    function setPage(page){
      // hide all
      ["home","auth","browse","owner","admin"].forEach(p => el("page-"+p).classList.add("hide"));

      setActiveTab(page);
      const section = el("page-" + page);
      section.classList.remove("hide");
      section.classList.add("pageFade");
      setTimeout(() => section.classList.remove("pageFade"), 250);

      const titles = {
        home: ["Home", "Welcome ‚Äî choose a panel to continue."],
        auth: ["Login / Register", "Sign in or create an account."],
        browse: ["Browse", "Explore businesses and available workers."],
        owner: ["Owner Panel", "Manage your businesses and worker requests."],
        admin: ["Admin Panel", "Oversee businesses and worker approvals."]
      };
      el("pageTitle").textContent = titles[page][0];
      el("pageSub").textContent = titles[page][1];
    }

    async function api(path, opts={}){
      const res = await fetch(API_BASE + path, {
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        ...opts
      });
      const text = await res.text();
      let data = null;
      try{ data = text ? JSON.parse(text) : null; }catch{ data = { raw: text }; }
      if(!res.ok){
        const msg = (data && (data.error || data.message)) || ("HTTP " + res.status);
        throw new Error(msg);
      }
      return data;
    }

    function statusTag(s){
      if(s === "ready") return `<span class="tag ok">Ready</span>`;
      if(s === "busy") return `<span class="tag warn">Busy</span>`;
      return `<span class="tag bad">Pending</span>`;
    }

    function markError(inputEl, msg){
      inputEl.classList.add("err");
      const old = inputEl.parentElement.querySelector(".help");
      if (old) old.remove();
      const d = document.createElement("div");
      d.className = "help";
      d.textContent = msg;
      inputEl.parentElement.appendChild(d);
    }
    function clearError(inputEl){
      inputEl.classList.remove("err");
      const old = inputEl.parentElement.querySelector(".help");
      if (old) old.remove();
    }

    // ===== Session state =====
    let me = null;
    let businesses = [];
    let workers = [];

    function updateWhoami(){
      const who = el("whoami");
      const logout = el("btnLogout");
      if(!me){
        who.textContent = "Not logged in";
        logout.classList.add("hide");
        return;
      }
      who.textContent = `${me.name} ‚Ä¢ ${me.role.toUpperCase()}`;
      logout.classList.remove("hide");
    }

    function fillWorkerProfile(){
      if(!me || me.role !== "worker") return;
      el("wSkills").value = me.worker?.skills || "";
      el("wExp").value = me.worker?.experience || "";
      el("wLoc").value = me.worker?.location || "";
      el("wStatus").value = me.worker?.status || "pending";
    }

    // ===== Render =====
    function renderBusinesses(){
      const q = el("qBrowse").value.trim().toLowerCase();
      const list = el("bizList");
      const bizSel = el("bizFilter").value;

      let rows = businesses.slice();
      if(q){
        rows = rows.filter(b =>
          (b.name||"").toLowerCase().includes(q) ||
          (b.category||"").toLowerCase().includes(q) ||
          (b.location||"").toLowerCase().includes(q)
        );
      }

      if(rows.length === 0){
        list.innerHTML = `
          <div class="empty">
            <div class="emptyIcon">üè¢</div>
            <div>
              <h3>No businesses found</h3>
              <p>Try a different search, or create a business from <b>Owner Panel</b>. If you are a worker, browse again after owners add businesses.</p>
            </div>
          </div>
        `;
        return;
      }

      list.innerHTML = rows.map(b => `
        <div class="item">
          <div class="itemMain">
            <p class="itemTitle">${escapeHtml(b.name)} <span class="tag">${escapeHtml(b.category || "General")}</span></p>
            <p class="itemMeta">${escapeHtml(b.location || "‚Äî")} ‚Ä¢ Business ID: ${b.id}</p>
          </div>
          <div class="itemActions">
            <button class="btn" onclick="selectBusiness(${b.id})">View workers</button>
          </div>
        </div>
      `).join("");
    }

    function renderWorkers(){
      const q = el("qBrowse").value.trim().toLowerCase();
      const status = el("statusFilter").value;
      const bizId = el("bizFilter").value;

      let rows = workers.slice();
      if(bizId) rows = rows.filter(w => String(w.business_id) === String(bizId));
      if(status) rows = rows.filter(w => w.status === status);

      if(q){
        rows = rows.filter(w =>
          (w.name||"").toLowerCase().includes(q) ||
          (w.skills||"").toLowerCase().includes(q) ||
          (w.location||"").toLowerCase().includes(q)
        );
      }

      const list = el("workerList");
      if(rows.length === 0){
        list.innerHTML = `
          <div class="empty">
            <div class="emptyIcon">üßë‚Äçüîß</div>
            <div>
              <h3>No workers match your filters</h3>
              <p>Clear filters, change business/status, or ask workers to complete their profiles and set status to <b>Ready</b>.</p>
            </div>
          </div>
        `;
        return;
      }

      list.innerHTML = rows.map(w => `
        <div class="item">
          <div class="itemMain">
            <p class="itemTitle">
              ${escapeHtml(w.name)}
              ${statusTag(w.status)}
            </p>
            <p class="itemMeta">
              Skills: ${escapeHtml(w.skills || "‚Äî")} ‚Ä¢ Exp: ${escapeHtml(w.experience || "‚Äî")} ‚Ä¢ ${escapeHtml(w.location || "‚Äî")}
            </p>
          </div>
          <div class="itemActions">
            <button class="btn" onclick="copyContact('${escapeJs(w.email||"")}')">Contact</button>
          </div>
        </div>
      `).join("");
    }

    // Owner requests / workers
    function renderOwnerRequests(reqs){
      const box = el("ownerRequests");
      if(!reqs || reqs.length === 0){
        box.innerHTML = `
          <div class="empty">
            <div class="emptyIcon">üì•</div>
            <div>
              <h3>No pending requests</h3>
              <p>When workers request to join your businesses, you‚Äôll approve them here.</p>
            </div>
          </div>
        `;
        return;
      }
      box.innerHTML = reqs.map(r => `
        <div class="item">
          <div class="itemMain">
            <p class="itemTitle">${escapeHtml(r.worker_name)} <span class="tag bad">Pending</span></p>
            <p class="itemMeta">Business: ${escapeHtml(r.business_name)} ‚Ä¢ Skills: ${escapeHtml(r.skills||"‚Äî")}</p>
          </div>
          <div class="itemActions">
            <button class="btn primary" onclick="ownerApprove(${r.request_id}, true)">Approve</button>
            <button class="btn danger" onclick="ownerApprove(${r.request_id}, false)">Reject</button>
          </div>
        </div>
      `).join("");
    }

    function renderOwnerWorkers(rows){
      const box = el("ownerWorkers");
      if(!rows || rows.length === 0){
        box.innerHTML = `
          <div class="empty">
            <div class="emptyIcon">üë∑</div>
            <div>
              <h3>No workers yet</h3>
              <p>Approve worker requests first. Then manage status here.</p>
            </div>
          </div>
        `;
        return;
      }

      box.innerHTML = rows.map(w => `
        <div class="item">
          <div class="itemMain">
            <p class="itemTitle">${escapeHtml(w.name)} ${statusTag(w.status)} <span class="tag">${escapeHtml(w.business_name)}</span></p>
            <p class="itemMeta">Skills: ${escapeHtml(w.skills||"‚Äî")} ‚Ä¢ ${escapeHtml(w.location||"‚Äî")}</p>
          </div>
          <div class="itemActions">
            <button class="btn" onclick="ownerSetStatus(${w.worker_id}, 'ready')">Ready</button>
            <button class="btn" onclick="ownerSetStatus(${w.worker_id}, 'busy')">Busy</button>
          </div>
        </div>
      `).join("");
    }

    // Admin lists
    function renderAdminBusinesses(rows){
      const box = el("adminBiz");
      if(!rows || rows.length === 0){
        box.innerHTML = `
          <div class="empty">
            <div class="emptyIcon">üóÇÔ∏è</div>
            <div>
              <h3>No businesses</h3>
              <p>Owners can create businesses. They will show up here.</p>
            </div>
          </div>
        `;
        return;
      }

      box.innerHTML = rows.map(b => `
        <div class="item">
          <div class="itemMain">
            <p class="itemTitle">${escapeHtml(b.name)} <span class="tag">${escapeHtml(b.category||"General")}</span></p>
            <p class="itemMeta">${escapeHtml(b.location||"‚Äî")} ‚Ä¢ Owner: ${escapeHtml(b.owner_name||"‚Äî")} ‚Ä¢ ID: ${b.id}</p>
          </div>
        </div>
      `).join("");
    }

    function renderAdminPending(rows){
      const box = el("adminPending");
      if(!rows || rows.length === 0){
        box.innerHTML = `
          <div class="empty">
            <div class="emptyIcon">‚úÖ</div>
            <div>
              <h3>No pending workers</h3>
              <p>When workers register, you can approve them here.</p>
            </div>
          </div>
        `;
        return;
      }

      box.innerHTML = rows.map(w => `
        <div class="item">
          <div class="itemMain">
            <p class="itemTitle">${escapeHtml(w.name)} <span class="tag bad">Pending</span></p>
            <p class="itemMeta">Email: ${escapeHtml(w.email)} ‚Ä¢ Skills: ${escapeHtml(w.skills||"‚Äî")} ‚Ä¢ Worker ID: ${w.id}</p>
          </div>
          <div class="itemActions">
            <button class="btn primary" onclick="adminApprove(${w.id}, true)">Approve</button>
            <button class="btn danger" onclick="adminApprove(${w.id}, false)">Reject</button>
          </div>
        </div>
      `).join("");
    }

    // ===== Actions =====
    window.selectBusiness = function(id){
      el("bizFilter").value = String(id);
      renderWorkers();
      toast("Filtered workers by business");
    }

    window.copyContact = async function(email){
      if(!email){ toast("No email available", true); return; }
      try{
        await navigator.clipboard.writeText(email);
        toast("Email copied to clipboard");
      }catch{
        toast("Copy failed ‚Äî browser blocked clipboard", true);
      }
    }

    // ===== Load data =====
    async function refreshBrowse(){
      businesses = await api("/api/businesses");
      workers = await api("/api/workers");

      // dropdowns
      const opts = ['<option value="">All businesses</option>']
        .concat(businesses.map(b => `<option value="${b.id}">${escapeHtml(b.name)}</option>`));
      el("bizFilter").innerHTML = opts.join("");
      el("joinBiz").innerHTML = ['<option value="">Select a business</option>']
        .concat(businesses.map(b => `<option value="${b.id}">${escapeHtml(b.name)}</option>`))
        .join("");

      renderBusinesses();
      renderWorkers();
    }

    async function refreshOwner(){
      const reqs = await api("/api/owner/requests");
      renderOwnerRequests(reqs);

      const rows = await api("/api/owner/workers");
      renderOwnerWorkers(rows);
    }

    async function refreshAdmin(){
      const biz = await api("/api/admin/businesses");
      renderAdminBusinesses(biz);

      const pending = await api("/api/admin/workers/pending");
      renderAdminPending(pending);
    }

    // Owner actions
    window.ownerApprove = async function(requestId, ok){
      try{
        await api("/api/owner/requests/" + requestId + "/decision", {
          method:"POST",
          body: JSON.stringify({ approve: !!ok })
        });
        toast(ok ? "Approved request" : "Rejected request");
        await refreshOwner();
        await refreshBrowse();
      }catch(e){
        toast(e.message, true);
      }
    }

    window.ownerSetStatus = async function(workerId, status){
      try{
        await api("/api/owner/workers/" + workerId + "/status", {
          method:"POST",
          body: JSON.stringify({ status })
        });
        toast("Updated worker status");
        await refreshOwner();
        await refreshBrowse();
      }catch(e){
        toast(e.message, true);
      }
    }

    // Admin actions
    window.adminApprove = async function(workerId, ok){
      try{
        await api("/api/admin/workers/" + workerId + "/decision", {
          method:"POST",
          body: JSON.stringify({ approve: !!ok })
        });
        toast(ok ? "Approved worker" : "Rejected worker");
        await refreshAdmin();
        await refreshBrowse();
      }catch(e){
        toast(e.message, true);
      }
    }

    // ===== Auth =====
    async function checkMe(){
      try{
        me = await api("/api/me");
        updateWhoami();
        fillWorkerProfile();
      }catch{
        me = null;
        updateWhoami();
      }
    }

    // ===== Safe escape =====
    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeJs(s){
      return String(s ?? "").replaceAll("\\","\\\\").replaceAll("'","\\'");
    }

    // ===== Wire UI =====
    $$(".pill").forEach(p => p.addEventListener("click", async () => {
      const page = p.dataset.page;
      setPage(page);

      // lazy refresh based on page
      try{
        if(page === "browse") await refreshBrowse();
        if(page === "owner") await refreshOwner();
        if(page === "admin") await refreshAdmin();
      }catch(e){
        toast(e.message, true);
      }
    }));

    el("ctaGetStarted").addEventListener("click", () => setPage("auth"));
    el("ctaBrowse").addEventListener("click", async () => { setPage("browse"); try{ await refreshBrowse(); }catch(e){ toast(e.message,true);} });

    el("qaGoLogin").addEventListener("click", () => setPage("auth"));
    el("qaGoBrowse").addEventListener("click", async () => { setPage("browse"); try{ await refreshBrowse(); }catch(e){ toast(e.message,true);} });
    el("qaGoOwner").addEventListener("click", async () => { setPage("owner"); try{ await refreshOwner(); }catch(e){ toast(e.message,true);} });
    el("qaGoAdmin").addEventListener("click", async () => { setPage("admin"); try{ await refreshAdmin(); }catch(e){ toast(e.message,true);} });

    el("btnTheme").addEventListener("click", () => {
      const html = document.documentElement;
      const cur = html.getAttribute("data-theme");
      html.setAttribute("data-theme", cur === "dark" ? "light" : "dark");
    });

    el("btnLogout").addEventListener("click", async () => {
      try{
        await api("/api/logout", { method:"POST", body: JSON.stringify({}) });
      }catch{}
      me = null;
      updateWhoami();
      toast("Logged out");
      setPage("home");
    });

    // Browse filters
    el("qBrowse").addEventListener("input", () => { renderBusinesses(); renderWorkers(); });
    el("statusFilter").addEventListener("change", renderWorkers);
    el("bizFilter").addEventListener("change", renderWorkers);

    // Login
    el("btnLogin").addEventListener("click", async () => {
      clearError(el("loginEmail"));
      clearError(el("loginPass"));

      const email = el("loginEmail").value.trim();
      const password = el("loginPass").value;

      let ok = true;
      if (!email.includes("@")) { markError(el("loginEmail"), "Enter a valid email"); ok = false; }
      if (password.length < 4) { markError(el("loginPass"), "Password must be at least 4 characters"); ok = false; }
      if (!ok) return;

      try{
        await api("/api/login", {
          method:"POST",
          body: JSON.stringify({ email, password })
        });
        await checkMe();
        toast("Logged in");
        if(me?.role === "owner") { setPage("owner"); await refreshOwner(); }
        else if(me?.role === "admin") { setPage("admin"); await refreshAdmin(); }
        else { setPage("browse"); await refreshBrowse(); }
      }catch(e){
        toast(e.message, true);
      }
    });

    // Register
    el("btnRegister").addEventListener("click", async () => {
      clearError(el("regName"));
      clearError(el("regEmail"));
      clearError(el("regPass"));

      const name = el("regName").value.trim();
      const role = el("regRole").value;
      const email = el("regEmail").value.trim();
      const password = el("regPass").value;

      let ok = true;
      if (name.length < 2) { markError(el("regName"), "Enter your full name"); ok = false; }
      if (!email.includes("@")) { markError(el("regEmail"), "Enter a valid email"); ok = false; }
      if (password.length < 4) { markError(el("regPass"), "Password must be at least 4 characters"); ok = false; }
      if (!ok) return;

      try{
        await api("/api/register", {
          method:"POST",
          body: JSON.stringify({ name, role, email, password })
        });
        toast("Account created ‚Äî you can login now");
        el("loginEmail").value = email;
        setPage("auth");
      }catch(e){
        toast(e.message, true);
      }
    });

    // Owner: create business
    el("btnCreateBiz").addEventListener("click", async () => {
      try{
        const name = el("bizName").value.trim();
        const category = el("bizCategory").value.trim();
        const location = el("bizLocation").value.trim();
        if(name.length < 2){ toast("Enter business name", true); return; }
        await api("/api/owner/businesses", {
          method:"POST",
          body: JSON.stringify({ name, category, location })
        });
        el("bizName").value = "";
        el("bizCategory").value = "";
        el("bizLocation").value = "";
        toast("Business created");
        await refreshOwner();
        await refreshBrowse();
      }catch(e){
        toast(e.message, true);
      }
    });

    // Worker: save profile
    el("btnSaveWorker").addEventListener("click", async () => {
      try{
        if(!me || me.role !== "worker"){ toast("Login as worker to save profile", true); return; }
        const skills = el("wSkills").value.trim();
        const experience = el("wExp").value.trim();
        const location = el("wLoc").value.trim();
        const status = el("wStatus").value;
        await api("/api/worker/profile", {
          method:"POST",
          body: JSON.stringify({ skills, experience, location, status })
        });
        toast("Profile saved");
        await checkMe();
        await refreshBrowse();
      }catch(e){
        toast(e.message, true);
      }
    });

    // Worker: request join
    el("btnJoinBiz").addEventListener("click", async () => {
      try{
        if(!me || me.role !== "worker"){ toast("Login as worker to request join", true); return; }
        const business_id = el("joinBiz").value;
        if(!business_id){ toast("Select a business", true); return; }
        await api("/api/worker/join", {
          method:"POST",
          body: JSON.stringify({ business_id: Number(business_id) })
        });
        toast("Join request sent");
        await refreshBrowse();
      }catch(e){
        toast(e.message, true);
      }
    });

    // ===== Health check =====
    async function health(){
      try{
        await api("/api/health");
        el("dotApi").classList.add("on");
        el("apiText").textContent = "API: online";
      }catch{
        el("dotApi").classList.remove("on");
        el("apiText").textContent = "API: offline";
      }
    }

    // ===== Start =====
    (async function init(){
      setPage("home");
      await health();
      await checkMe();
      try{ await refreshBrowse(); }catch{}
    })();
  </script>
</body>
</html>
